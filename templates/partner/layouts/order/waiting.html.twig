{% extends 'partner/base.html.twig' %}

{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('plugins/datatable/css/dataTables.bootstrap5.min.css') }}">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css">
{% endblock %}


{% block body %}
<div class="card mt-4">
	<div class="card-body">
		<div class="customer-table">
			<div class="table-responsive white-space-nowrap">
				<table class="table align-middle">
					<thead class="table-light">
						<tr>
							<th>
								<input class="form-check-input" type="checkbox">
							</th>
							<th>Sipariş Numarası</th>
							<th>Fiyat</th>
							<th>Siparişi Veren</th>
							<th>Teslimat Durumu</th>
							<th>Ödeme Türü</th>
							<th>Tarih</th>
							<th>İşlem</th>
						</tr>
					</thead>
					<tbody>
						<!-- Order Information -->
						{% for order in orders %}
							<tr>
								<td>
									<input class="form-check-input" type="checkbox">
								</td>
								<td>
									<a id="orderId" href="/partner/order/detail/{{ order.id }}">
										{{ order.id }}
									</a>
								</td>
								<td>{{ order.grandTotal }}₺</td>
								<td>
									<a class="d-flex align-items-center gap-3" href="javascript:;">
										<div class="customer-avatar rounded-circle" width="40" height="40" alt=""></div>
										<p  class="mb-0 customer-name fw-bold" >
											{{ order.user.id|slice(0, 3) ~ '****' }}
										</p>
									</a>
								</td>
								<td>
									{% set statusClass = '' %}
									{% set statusText = '' %}
									{% set iconClass = '' %}

									{% if order.status == 'pending' %}
										{% set statusClass = 'lable-table bg-warning-subtle text-warning border-warning-subtle font-text2 fw-bold' %}
										{% set statusText = 'Bekleniyor' %}
										{% set iconClass = 'bi bi-hourglass-split' %}
									{% else %}
										{% set statusClass = 'lable-table bg-secondary-subtle text-secondary border-secondary-subtle font-text2 fw-bold' %}
										{% set statusText = 'Bilinmeyen' %}
										{% set iconClass = 'bi bi-question-circle' %}
									{% endif %}

									<span class="label-table {{ statusClass }} rounded font-text2 fw-bold">
										{{ statusText }}
										<i class="{{ iconClass }} ms-2"></i>
									</span>
								</td>

								<td>Nakit Ödeme</td>
								<td>
									{{ order.createdAt|date("j F, Y") }}
								</td>
								<td class="d-flex">
									<div id="orderUpdate">
										<button class="btn btn-grd btn-primary accept-btn" data-status="accepted" data-id="{{ order.id }}" data-bs-toggle="modal" data-bs-target="#orderConfirmModal-{{ order.id }}">
											<i class="fadeIn animated bx bx-check"></i>
										</button>
										<button class="btn btn-grd btn-danger reject-btn" data-status="rejected" data-id="{{ order.id }}" data-bs-toggle="modal" data-bs-target="#orderConfirmModal-{{ order.id }}">
											<i class="fadeIn animated lni lni-trash"></i>
										</button>
										<button class="btn btn-grd btn-warning" onClick="viewOrder(this)" data-id="{{ order.id }}" data-bs-toggle="modal" data-bs-target="#orderViewModal-{{ order.id }}">
											<i class="fadeIn animated lni lni-eye"></i>
										</button>
									</div>
								</td>
								<!-- Accept/Reject Modal -->
								<div class="modal fade" id="orderConfirmModal-{{ order.id }}" tabindex="-1" aria-hidden="true">
									<div class="modal-dialog modal-dialog-centered">
										<div class="modal-content">
											<div class="modal-header border-bottom-0 py-2">
												<h5 class="modal-title" id="modalTitle-{{ order.id }}">Sipariş Onayı</h5>
												<a href="javascript:;" class="primaery-menu-close" data-bs-dismiss="modal">
													<i class="material-icons-outlined">close</i>
												</a>
											</div>
											<div class="modal-body" id="modalBody-{{ order.id }}"></div>
											<div class="modal-footer border-top-0">
												<button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-status="accepted" data-id="{{ order.id }}">
													İptal
												</button>
												<button type="button" class="btn btn-primary" id="modalConfirmBtn-{{ order.id }}" data-status="rejected" data-id="{{ order.id }}">
													Onayla
												</button>
											</div>
										</div>
									</div>
								</div>
								<!-- View Order Modal -->
								<div class="modal fade" id="orderViewModal-{{ order.id }}" tabindex="-1" aria-hidden="true">
									<div class="modal-dialog">
										<div class="modal-content">
											<div class="modal-header">
												<h5 class="modal-title">Sipariş Detayı #{{ order.id }}</h5>
												<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
											</div>
											<div class="modal-body">
												<div id="orderOutput-{{ order.id }}">Yükleniyor...</div>
											</div>
										</div>
									</div>
								</div>
							</tr>
						{% endfor %}
						<!-- Order Information End -->
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>
{% if totalPages > 1 %}
    <nav aria-label="Sayfalama">
        <ul class="pagination justify-content-center mt-4">

            {# Önceki Sayfa #}
            <li class="page-item {% if currentPage == 1 %}disabled{% endif %}">
                <a class="page-link"
                   href="{{ path('partner_order_waiting', {'page': currentPage > 1 ? currentPage - 1 : 1, 'limit': limit}) }}"
                   aria-label="Önceki">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>

            {# Sayfa Numaraları (Önceki ve Sonraki 2 Sayfa Gösterimi) #}
            {% set pageRange = 2 %}
            {% set startPage = max(currentPage - pageRange, 1) %}
            {% set endPage = min(currentPage + pageRange, totalPages) %}

            {% for i in startPage..endPage %}
                <li class="page-item {% if i == currentPage %}active{% endif %}">
                    <a class="page-link" href="{{ path('partner_order_waiting', {'page': i, 'limit': limit}) }}">{{ i }}</a>
                </li>
            {% endfor %}

            {# Sonraki Sayfa #}
            <li class="page-item {% if currentPage == totalPages %}disabled{% endif %}">
                <a class="page-link"
                   href="{{ path('partner_order_waiting', {'page': currentPage < totalPages ? currentPage + 1 : totalPages, 'limit': limit}) }}"
                   aria-label="Sonraki">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>
{% endif %}



{% endblock %}


{% block javascripts %}
	<script src="{{ asset('plugins/datatable/js/jquery.dataTables.min.js') }}"></script>
	<script src="{{ asset('plugins/datatable/js/dataTables.bootstrap5.min.js') }}"></script>
	<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
	<script src="{{ asset('plugins/select2/js/select2-custom.js') }}"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js" async defer></script>

	<script type="module" src="{{ asset('script/partner/order/order.js') }}"></script>
{% endblock %}
