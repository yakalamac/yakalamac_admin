{% extends 'partner/base.html.twig' %}

{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('plugins/datatable/css/dataTables.bootstrap5.min.css') }}">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css">
{% endblock %}


{% block body %}
<div class="card mt-4">
    <div class="card-body">
        <div class="customer-table">
            <div class="table-responsive white-space-nowrap">
                <table class="table align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>
                                <input class="form-check-input" type="checkbox">
                            </th>
                            <th>Sipariş Numarası</th>
                            <th>Fiyat</th>
                            <th>Siparişi Veren</th>
                            <th>Teslimat Durumu</th>
                            <th>Ödeme Türü</th>
                            <th>Tarih</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Order Information -->
                        {% for order in orders %}  
                            <tr>
                                <td>
                                    <input class="form-check-input" type="checkbox">
                                </td>
                                <td>
                                    <a id="orderId" href="/partner/order/detail/{{ order.id }}">
                                        #{{ order.id|slice(0, 8) }}
                                    </a>
                                </td>
                                <td>{{ order.grandTotal }}₺</td>
                                <td>
                                    <a class="d-flex align-items-center gap-3" href="javascript:;">
                                        <div class="customer-avatar rounded-circle" width="40" height="40" alt=""></div>
                                        {% set userIdPath = order.user['@id'] is defined ? order.user['@id'] : order.user %}
                                        <p class="mb-0 customer-name fw-bold">
                                            {{ order.user.id|slice(0, 3) ~ '****' }}
                                        </p>
                                    </a>
                                </td>
                                <td>
                                    <!-- Order Status Display Logic -->
                                    {% set statusClass = '' %}
                                    {% set statusText = '' %}
                                    {% set iconClass = '' %}
                                    {% if order.status == 'pending' %}
                                        {% set statusClass = 'lable-table bg-warning-subtle text-warning border-warning-subtle font-text2 fw-bold' %}
                                        {% set statusText = 'Bekleniyor' %}
                                        {% set iconClass = 'bi bi-hourglass-split' %}
                                    {% elseif order.status == 'cancelled_user' %}
                                        {% set statusClass = 'lable-table bg-danger-subtle text-danger border-danger-subtle font-text2 fw-bold' %}
                                        {% set statusText = 'Kullanıcı İptal Etti' %}
                                        {% set iconClass = 'bi bi-person-x' %}
                                    {% elseif order.status == 'cancelled_business' %}
                                        {% set statusClass = 'lable-table bg-danger-subtle text-danger border-danger-subtle font-text2 fw-bold' %}
                                        {% set statusText = 'İşletme İptal Etti' %}
                                        {% set iconClass = 'bi bi-shop-window' %}
                                    {% elseif order.status == 'rejected' %}
                                        {% set statusClass = 'lable-table bg-danger-subtle text-danger border-danger-subtle font-text2 fw-bold' %}
                                        {% set statusText = 'İşletme İşleme Almadan İptal Etti' %}
                                        {% set iconClass = 'bi bi-x-circle' %}
                                    {% elseif order.status == 'delivered' %}
                                        {% set statusClass = 'lable-table bg-success-subtle text-success border-success-subtle font-text2 fw-bold' %}
                                        {% set statusText = 'Teslim Edildi' %}
                                        {% set iconClass = 'bi bi-check-circle' %}
                                    {% elseif order.status == 'accepted' %}
                                        {% set statusClass = 'lable-table bg-success-subtle text-success border-success-subtle font-text2 fw-bold' %}
                                        {% set statusText = 'Kabul Edildi' %}
                                        {% set iconClass = 'bi bi-check2-circle' %}
                                    {% elseif order.status == 'ready' %}
                                        {% set statusClass = 'lable-table bg-warning-subtle text-warning border-warning-subtle font-text2 fw-bold' %}
                                        {% set statusText = 'Kurye Bekleniyor' %}
                                        {% set iconClass = 'bi bi-person-check' %}
                                    {% elseif order.status == 'delivery' %}
                                        {% set statusClass = 'lable-table bg-warning-subtle text-warning border-warning-subtle font-text2 fw-bold' %}
                                        {% set statusText = 'Yolda' %}
                                        {% set iconClass = 'bi bi-truck' %}
									{% elseif order.status == 'preparing' %}
                                        {% set statusClass = 'lable-table bg-warning-subtle text-warning border-warning-subtle font-text2 fw-bold' %}
                                        {% set statusText = 'Hazırlanıyor' %}
                                        {% set iconClass = 'bi bi-hourglass-split' %}
                                    {% else %}
                                        {% set statusClass = 'lable-table bg-secondary-subtle text-secondary border-secondary-subtle font-text2 fw-bold' %}
                                        {% set statusText = 'Bilinmeyen' %}
                                        {% set iconClass = 'bi bi-question-circle' %}
                                    {% endif %}
                                    <span class="label-table {{ statusClass }} rounded font-text2 fw-bold">
                                        {{ statusText }}
                                        <i class="{{ iconClass }} ms-2"></i>
                                    </span>
                                </td>
                                <td>Nakit Ödeme</td>
                                <td>
                                    {{ order.createdAt|date("j F, Y") }}
                                </td>			
                            </tr>			
                        {% endfor %}
                    </tbody>

                </table>
            </div>
        </div>
    </div>
</div>
{% if totalPages > 1 %}
    <nav aria-label="Sayfalama">
        <ul class="pagination justify-content-center mt-4">
            {% if currentPage > 1 %}
                <li class="page-item">
                    <a class="page-link" href="{{ path('partner_order_history', { page: currentPage - 1 }) }}" aria-label="Önceki">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
            {% endif %}
            {% for i in 1..totalPages %}
                <li class="page-item {% if i == currentPage %}active{% endif %}">
                    <a class="page-link" href="{{ path('partner_order_history', { page: i }) }}">{{ i }}</a>
                </li>
            {% endfor %}
            {% if currentPage < totalPages %}
                <li class="page-item">
                    <a class="page-link" href="{{ path('partner_order_history', { page: currentPage + 1 }) }}" aria-label="Sonraki">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
{% endif %}	

{% endblock %}


{% block javascripts %}
	<script src="{{ asset('plugins/datatable/js/jquery.dataTables.min.js') }}"></script>
	<script src="{{ asset('plugins/datatable/js/dataTables.bootstrap5.min.js') }}"></script>
	<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
	<script src="{{ asset('plugins/select2/js/select2-custom.js') }}"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js" async defer></script>
	<script src="{{ asset('script/partner/order/order.js') }}"></script>
{% endblock %}
