{% extends 'partner/base.html.twig' %}

{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('plugins/datatable/css/dataTables.bootstrap5.min.css') }}">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css">
{% endblock %}


{% block body %}
<div class="card mt-4">
	<div class="card-body">
		<div class="customer-table">
			<div class="table-responsive white-space-nowrap">
				<table class="table align-middle">
					<thead class="table-light">
						<tr>
							<th>
								<input class="form-check-input" type="checkbox">
							</th>
							<th>Sipariş Numarası</th>
							<th>Fiyat</th>
							<th>Siparişi Veren</th>
							<th>Teslimat Durumu</th>
							<th>Ödeme Türü</th>
							<th>Tarih</th>
						</tr>
					</thead>
					<tbody>
						<!-- Order Information -->
						{% for order in orders %}
							<tr>
								<td>
									<input class="form-check-input" type="checkbox">
								</td>
								<td>
									<a id="orderId" href="/partner/order/detail/{{ order.id }}">
											{{ order.id }}
									</a>
								</td>
								<td>{{ order.grandTotal }}₺</td>
								<td>
									<a class="d-flex align-items-center gap-3" href="javascript:;">
										<div class="customer-avatar rounded-circle" width="40" height="40" alt=""></div>
										<p class="mb-0 customer-name fw-bold">
											{{ order.user.id|slice(0, 3) ~ '****' }}
										</p>
									</a>
								</td>
								<td>
									{% set statusClass = '' %}
									{% set statusText = '' %}
									{% set iconClass = '' %}

									{% if order.status == 'cancelled_user' %}
										{% set statusClass = 'lable-table bg-danger-subtle text-danger border-danger-subtle font-text2 fw-bold' %}
										{% set statusText = 'Kullanıcı İptal Etti' %}
										{% set iconClass = 'bi bi-person-x' %}
									{% elseif order.status == 'cancelled_business' %}
										{% set statusClass = 'lable-table bg-danger-subtle text-danger border-danger-subtle font-text2 fw-bold' %}
										{% set statusText = 'İşletme İptal Etti' %}
										{% set iconClass = 'bi bi-shop-window' %}
									{% elseif order.status == 'rejected' %}
										{% set statusClass = 'lable-table bg-danger-subtle text-danger border-danger-subtle font-text2 fw-bold' %}
										{% set statusText = 'İşletme İşleme Almadan İptal Etti' %}
										{% set iconClass = 'bi bi-x-circle' %}
									{% else %}
										{% set statusClass = 'lable-table bg-secondary-subtle text-secondary border-secondary-subtle font-text2 fw-bold' %}
										{% set statusText = 'Bilinmeyen' %}
										{% set iconClass = 'bi bi-question-circle' %}
									{% endif %}

									<span class="label-table {{ statusClass }} rounded font-text2 fw-bold">
										{{ statusText }}
										<i class="{{ iconClass }} ms-2"></i>
									</span>
								</td>
								<td>Nakit Ödeme</td>
								<td>
									{{ order.createdAt|date("j F, Y") }}
								</td>
							</tr>
						{% endfor %}
						<!-- Order Information End -->
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>

{% if totalPages > 1 %}
    <nav aria-label="Sayfalama">
        <ul class="pagination justify-content-center mt-4">
            
            {# Önceki Sayfa #}
            <li class="page-item {% if currentPage == 1 %}disabled{% endif %}">
                <a class="page-link" 
                   href="{{ path('partner_order_cancelled', {'page': currentPage > 1 ? currentPage - 1 : 1, 'limit': limit}) }}" 
                   aria-label="Önceki">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>

            {# Sayfa Numaraları (Önceki ve Sonraki 2 Sayfa Gösterimi) #}
            {% set pageRange = 2 %}
            {% set startPage = max(currentPage - pageRange, 1) %}
            {% set endPage = min(currentPage + pageRange, totalPages) %}

            {% for i in startPage..endPage %}
                <li class="page-item {% if i == currentPage %}active{% endif %}">
                    <a class="page-link" href="{{ path('partner_order_cancelled', {'page': i, 'limit': limit}) }}">{{ i }}</a>
                </li>
            {% endfor %}

            {# Sonraki Sayfa #}
            <li class="page-item {% if currentPage == totalPages %}disabled{% endif %}">
                <a class="page-link" 
                   href="{{ path('partner_order_cancelled', {'page': currentPage < totalPages ? currentPage + 1 : totalPages, 'limit': limit}) }}" 
                   aria-label="Sonraki">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>
{% endif %}





{% endblock %}


{% block javascripts %}
	<script src="{{ asset('plugins/datatable/js/jquery.dataTables.min.js') }}"></script>
	<script src="{{ asset('plugins/datatable/js/dataTables.bootstrap5.min.js') }}"></script>
	<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
	<script src="{{ asset('plugins/select2/js/select2-custom.js') }}"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js" async defer></script>

	<script type="module" src="{{ asset('script/partner/product/product.js') }}"></script>
{% endblock %}
