# platform.app.yaml
#Unique name for the app. Must be lowercase alphanumeric chars.
#Changing the name destroys data associated with the app
name: app
#The base image to use with a specific app language
#Format runtime:version
#For example: For c#/ .net core => dotnet:7.0
# See https://docs.platform.sh/create-apps/app-reference/single-runtime-image.html#types
type: 'php:8.3'

#How much resources to devote to the app. Defaults to AUTO in production environments.
#See https://docs.platform.sh/create-apps/app-reference/single-runtime-image.html#sizes
# size: S (example)
#Size:

dependencies:
  php:
    composer/composer: "^2"

runtime:
  extensions:
    - apcu
    - blackfire
    - ctype
    - iconv
    - mbstring
    - pdo_pgsql
    - sodium
    - xsl
    #- redis # For PHP, enable the extension for the service:
    #- imagick #For PHP, enable the imagick extension

#Connections to other services and apps.
#https://docs.platform.sh/create-apps/app-reference/single-runtime-image.html#relationships
relationships:
  database: "postgresql:postgresql"
  #servisadıservicesyamldaolan:servis database ise env adı
#  elasticsearch: "elasticsearch:elasticsearch"
#  redis: "redis:redis"


variables:
  php:
    opcache.preload: config/preload.php
  env:
    API_URL: "https://apiv2.yaka.la"
    ELASTIC_URL: "https://elastic:37MwQTrJ1md0RZfztsx8@esv2.yaka.la/"

    GOOGLE_PLACES_API_KEY: "AIzaSyBRToxk3Zkra5esa4ai3vZywkSdvH1-9AU"

    GOOGLE_CLIENT_ID: "901480078814-hs3spn3kcfl5rbv6fjqn14ghjufgs1ok.apps.googleusercontent.com"
    GOOGLE_CLIENT_SECRET: "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"
    GOOGLE_SCOPE: "https://www.googleapis.com/auth/userinfo.email"
    GOOGLE_ACCESS_TYPE: "offline"
    GOOGE_INCLUDE_GRANTED_SCOPES: 1
    GOOGLE_RESPONSE_TYPE: "code"
    GOOGLE_PROMPT: "select_account"
    GOOGLE_AUTH_BASE_URI: "https://accounts.google.com/o/oauth2/v2/auth"
    GOOGLE_REDIRECT_URI: "https://panel.yaka.la/oauth2/callback"

    APPLE_CLIENT_ID: "la.yaka.api"
    APPLE_TEAM_ID: "ZN2NH6SK28"
    APPLE_RESPONSE_MODE: "web_message"
    APPLE_RESPONSE_TYPE: "code id_token"
    APPLE_REDIRECT_URI: "https://panel.yaka.la/oauth2/callback"

    APPLE_BUNDLE_ID: "com.domainname.yakalamac"
    APPLE_PRIVATE_KEY_PATH: "/config/ssl/AuthKey_ZVH8J4DU7Z.p8"
    APPLE_PRIVATE_KEY_ID: "ZVH8J4DU7Z"
    APPLE_SCOPE: "name email"
    APPLE_AUTH_BASE_URI: "https://appleid.apple.com/auth/authorize"

build:
  flavor: composer

disk: 1024

#How the web application is served.
#https://docs.platform.sh/create-apps/app-reference/single-runtime-image.html#web

web:
  locations:
    "/":
      root: "public"
      expires: 1h
      passthru: "/index.php"

#Directories that are writable even after the app is built. If set as a local source disk is required
# https://docs.platform.sh/create-apps/app-reference/single-runtime-image.html#mounts

mounts:
  "/var": { source: local, source_path: var }

hooks:
  build: |
    set -x -e
    
    curl -fs https://get.symfony.com/cloud/configurator | bash
    
    NODE_VERSION=18 symfony-build

  deploy: |
    set -x -e
    
    symfony-deploy

crons:
  security-check:
    # Check that no security issues have been found for PHP packages deployed in production
    # See https://github.com/fabpot/local-php-security-checker
    spec: '50 23 * * *'
    cmd: if [ "$PLATFORM_ENVIRONMENT_TYPE" = "production" ]; then croncape php-security-checker; fi